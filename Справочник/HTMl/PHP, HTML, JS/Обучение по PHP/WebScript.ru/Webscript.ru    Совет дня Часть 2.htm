<html><script language="JavaScript" type="text/javascript"> window.onerror=new Function("return true;"); </script><HEAD><TITLE>Webscript.ru :: веб программирование для всех.</TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1251">
<META http-equiv=Content-Language content=ru>
<META content="Hands v. 2.0" name=generator>
<META content="Каталог скриптов (PHP &amp; Perl), хостинг, бесплатные скрипты, Форумы, счетчики, поиск, голосования, гостевые книги, новости, чаты, статистика, ссылки, возвратные формы, перл, цги, perl,php,php3,mysql, webmaster, вебмастер, free" name=keywords>
<META content="Каталог скриптов (PHP &amp; Perl). Аналитические статьи. Новости для вебмастеров. Большой форум. Аукцион. Бесплатные скрипты." name=description><LINK href="Webscript.ru    Совет дня Часть 2-Dateien\csblank.gif" rel=stylesheet>

</HEAD>
<BODY text=#000000 bgColor=#cccccc leftMargin=0 topMargin=0 marginheight="0" marginwidth="0">
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD width=278><A href="http://www.webscript.ru"><IMG height=55 alt=WebScript.Ru hspace=5 src="Webscript.ru    Совет дня Часть 2-Dateien\logo.gif" width=268 vspace=15 border=0></A></TD><!-- Ушки -->
<TD><IMG height=1 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\p.gif" width=15></TD>
<TD align=left width=510 background="Webscript.ru    Совет дня Часть 2-Dateien\bg1.gif"><IFRAME id=a1af6a68 name=a1af6a68 frameSpacing=0 src="Webscript.ru    Совет дня Часть 2-Dateien\csblank.gif" frameBorder=no width=468 scrolling=no height=60><a href='http://base.webscript.ru/adclick.php?n=a1af6a68' target='_blank'><img src="Webscript.ru    Совет дня Часть 2-Dateien\csblank.gif" border='0' alt=''></a></IFRAME></TD>
<TD><IMG height=1 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\p.gif" width=2>
<TD width=1 bgColor=white><IMG height=1 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\p.gif" width=1></TD>
<TD width="99%" bgColor=#555555></TD></TR></TBODY></TABLE><!-- Таблица с меню -->
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=#dddddd border=0>
<TBODY>
<TR>
<TD><IMG height=2 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\p.gif" width=1></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=2 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD class=mnu><FONT color=red>C:\&nbsp; <A class=mnu href="http://www.webscript.ru/">&nbsp;главная&nbsp;</A> :: <A class=mnu href="http://www.webscript.ru/pages.php3?page=О+сайте">&nbsp; о сайте&nbsp;</A> :: <A class=mnu href="http://www.webscript.ru/scripts">&nbsp;каталог скриптов&nbsp;</A> :: <A class=mnu href="http://gnezdo.webscript.ru/">&nbsp;гнездо&nbsp;</A> :: <A class=mnu href="http://hostobzor.webscript.ru/">&nbsp;хостОбзор&nbsp;</A> :: <A class=mnu href="http://forums.webscript.ru">&nbsp;форум&nbsp;</A> :: <A class=mnu href="http://www.webscript.ru/pages.php3?page=Авторам">&nbsp; авторам&nbsp;</A> :: <A class=mnu title="Реклама на Webscript.ru" href="http://webscript.ru/stat/click.php?http://www.webscript.ru/pages.php3?page=Advertisment">Реклама </A>:: <A class=mnu title="Виртуальные выделенные сервера от 4.95$" href="http://webscript.ru/click/fclick.php?fid=1">&nbsp; ХОСТИНГ&nbsp;</A> :: </FONT></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=#999999 border=0>
<TBODY>
<TR>
<TD><IMG height=2 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\p.gif" width=1></TD></TR></TBODY></TABLE><!-- Главная таблица -->
<TABLE cellSpacing=0 cellPadding=0 width=760 bgColor=white border=0>
<TBODY>
<TR><!-- Колонка слева -->
<TD vAlign=top width=200 bgColor=#f0f0f0><IMG height=7 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\p.gif" width=200><BR><!-- Разделы -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="Webscript.ru    Совет дня Часть 2-Dateien\bg5.gif"><IMG height=14 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\a1.gif" width=20 align=left border=0> || разделы::</TD></TR>
<TR>
<TD width=200 background="Webscript.ru    Совет дня Часть 2-Dateien\bg2.gif" bgColor=white>
<DIV class=maintext><B>:: <A href="http://www.webscript.ru/stories.php3?topic=2">новости сайта</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=3">новости Perl</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=5">статьи по Perl</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=4">новости PHP</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=6">статьи по PHP</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=7">веб-технологии</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=8">публикации</A><BR>
<HR>
:: <A href="http://www.webscript.ru/sanitarium">Sanitarium WebLoG</A><BR>:: <A href="http://www.webscript.ru/mp">MobilePublisherPHP</A><BR></B></DIV></TD></TR></TBODY></TABLE><!-- Новости -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="Webscript.ru    Совет дня Часть 2-Dateien\bg5.gif"><IMG height=14 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\a1.gif" width=20 align=left border=0> || новости почтой::</TD></TR>
<TR>
<TD width=200 bgColor=white>
<DIV class=verd>
<FORM action=http://subscribe.ru/member/quick method=get target=_top><INPUT type=hidden value=quick name=action> <B>Рассылки <A href="http://subscribe.ru/">Subscribe.Ru</A> ::</B><BR><BR><INPUT class=frm maxLength=100 size=15 value="ваш e-mail" name=email> <INPUT class=frm type=submit value=Ok><BR><BR><INPUT class=frm type=checkbox CHECKED value=inet.webbuild.webscript name=grp> Новости сайта WebScript.Ru </FORM></DIV></TD></TR></TBODY></TABLE><!-- поиск -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="Webscript.ru    Совет дня Часть 2-Dateien\bg5.gif"><IMG height=14 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\a1.gif" width=20 align=left border=0> || поиск по сайту::</TD></TR>
<TR>
<TD width=200 bgColor=white>
<DIV class=verd align=right>
<FORM action=http://www.webscript.ru/search.php3 method=get><B>Искать</B>:<INPUT class=frm maxLength=35 size=18 name=query><BR><B>где :</B> <SELECT class=frm name=topic> <OPTION value=0 selected>Все разделы</OPTION> <OPTION value=3>Новости Perl</OPTION> <OPTION value=2>Новости сайта</OPTION> <OPTION value=4>Новости PHP</OPTION> <OPTION value=5>Статьи по Perl</OPTION> <OPTION value=6>Статьи по PHP</OPTION> <OPTION value=7>Веб-технологии</OPTION> <OPTION value=8>Публикации</OPTION></SELECT><BR>статьи <INPUT type=radio CHECKED value=stories name=what><BR>комментарии <INPUT type=radio value=comments name=what><BR><BR>Результатов: <SELECT class=frm name=limit> <OPTION value=10>10</OPTION> <OPTION value=20>20</OPTION> <OPTION value=30 selected>30</OPTION> <OPTION value=40>40</OPTION> <OPTION value=50>50</OPTION></SELECT> <INPUT class=frm type=submit value=" Ok "> </FORM><BR></DIV></TD></TR></TBODY></TABLE><!-- begin blocks column (l) //--><!-- BLOCK START default -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="Webscript.ru    Совет дня Часть 2-Dateien\csblank.gif"><IMG height=14 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\csblank.gif" width=20 align=left border=0>|| Nавигатор</TD></TR>
<TR>
<TD width=200 bgColor=#f5f5f5>


<UL>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=15178">MySQL 5 beta</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=15144">[bug] IE bug, позволяющий подменить URL in Location</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=14237">[site] кУ/Роводство и проверка орфографии</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=14177">[news] Mozilla 1.5 out (остальные из семейства - тоже)</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=14070">[fun] Google крут! :)</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=13692&msgnum=0">[news] разные новости </A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=13514">[news] Протест против патентов на ПО в Европе</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=13344">[soft] PHP " " Mozilla "-" Web server ! :)</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=13033">Вышел Win2k SP4 (ru)!</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=12804&msgnum=0">[soft] OpenGroupware - Свершилось! Альтернатива MS Exchange</A></LI></UL><BR><BR></TD></TR></TBODY></TABLE><!-- BLOCK END --><!-- BLOCK START default -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="http://www.webscript.ru/stories/img/bg5.gif"><IMG height=14 alt="" src="http://www.webscript.ru/stories/img/a1.gif" width=20 align=left border=0>Популярные статьи</TD></TR>
<TR>
<TD width=200 bgColor=#f5f5f5>
<UL>
<LI><A href="http://www.webscript.ru/stories/01/05/31/4704330">Введение в PHP</A> (28) 
<LI><A href="http://www.webscript.ru/stories/01/06/06/8148134">Форум, работающий с базой данных MySQL</A> (29) 
<LI><A href="http://www.webscript.ru/stories/01/06/18/2730108">Аутентификация пользователей через Веб-интерфейс</A> (22) 
<LI><A href="http://www.webscript.ru/stories/01/06/08/4295014">Отправка писем через PHP</A> (53) 
<LI><A href="http://www.webscript.ru/stories/02/05/06/5105096">Гостевая книга на PHP/MySQL</A> (17) </LI></UL><BR></TD></TR></TBODY></TABLE><!-- BLOCK END --><!-- end blocks column (l) //--><!-- кнопки -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="Webscript.ru    Совет дня Часть 2-Dateien\bg5.gif"><IMG height=14 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\a1.gif" width=20 align=left border=0> || рекомендуем::</TD></TR>
<TR>
<TD width=200 bgColor=white>
<DIV align=center>
<CENTER><BR><A href="http://ricn.ru/"><IMG height=31 alt="Здесь живет Моська Рунета !" src="Webscript.ru    Совет дня Часть 2-Dateien\88moska2.gif" width=88 border=0></A> <A href="http://www.proge.ru/"><IMG height=31 alt="Библиотека программиста" src="Webscript.ru    Совет дня Часть 2-Dateien\prog.gif" width=88 border=0></A> <BR><A href="http://www.searchengines.ru/"><IMG height=31 alt="Поисковые системы, оптимизация и раскрутка сайта" src="Webscript.ru    Совет дня Часть 2-Dateien\se31.gif" width=88 border=0></A> </A><BR><A href="http://www.21vek.ru/web/notebook.jsp">Ноутбуки 21Века</A> </CENTER></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\p.gif" width=1></TD></TR></TBODY></TABLE><BR><BR><!-- Правая колонка --></TD>
<TD width=1 bgColor=black><IMG height=1 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\p.gif" width=1></TD>
<TD vAlign=top width=560><!-- Баннер --><BR>
<BLOCKQUOTE>



<A href="http://base.webscript.ru/adclick.php?bannerid=72&zoneid=3&source=&dest=http://www.books.ru/shop/books/31278?partner=nas" target=_blank><B>[PostgreSQL. Для профессионалов (с CD-ROM)]</B><BR>В книге рассматриваются практические аспекты установки и сопровождения сервера БД на базе PostgreSQL. Основное внимание уделяется таким стандартным операциям, как архивация и восстановление баз данных, управление учетными записями пользователей, создание новых баз данных, запуск и остановка сервера и т.д. </A>
<DIV id=beacon_72 style="LEFT: 0px; VISIBILITY: hidden; POSITION: absolute; TOP: 0px"><IMG style="WIDTH: 0px; HEIGHT: 0px" height=0 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\csblank.gif" width=0></DIV><NOSCRIPT><a href='http://base.webscript.ru/adclick.php?n=aed8abce'><img src="Webscript.ru    Совет дня Часть 2-Dateien\adview.php.gif" border='0' alt=''></a></NOSCRIPT></BLOCKQUOTE><!-- STORY START default --><!-- Блок с анонсом -->
<TABLE cellSpacing=0 cellPadding=20 width=560 bgColor=white border=0>
<TBODY>
<TR>
<TD>
<H1>Система "Совет дня". Часть 2</H1><BR>
<DIV align=right><SMALL>Прислал: <B><SPAN class=author><A href="http://www.webscript.ru/profiles.php3?Author=NAS&AuthorEmail=anf@enzoyre.eh&AuthorURL=http://webscript.ru">NAS</A></SPAN></B> [ 01.10.2000 @ 15:00 ]<BR>Раздел:: [ <B><A href="http://www.webscript.ru/stories.php3?topic=6">Статьи по PHP</A></B> ]</SMALL><BR></DIV><BR><B>Система "Совет дня". Часть 2.</B> 
<P>В <A href="http://webscript.ru/stories.php?story=20">прошлый</A> раз я остановился на ситуации, когда в базе отсутствует совет дня, соответствующий текущей дате. В этом случае нужно выбрать самый поздний совет. Для этого используем следующий SQL-запрос:</P><PRE class=js>SELECT * FROM tipoad WHERE startdate &lt; NOW() ORDER BY startdate DESC
</PRE>
<P>В переводе на русский это выглядит так: Выбрать все поля из таблицы <SPAN class=js>tipoad</SPAN>, дата выхода которых меньше, чем текущая, отсортировав их в порядке убывания даты. Таким образом в первой строке результата у нас будет находиться информация об искомом совете. На php записываем это так.</P><PRE class=js>$sql = "SELECT * FROM tipoad WHERE startdate = NOW()";
$res = mysql_query($sql);
if (!(mysql_num_rows($res)&gt;0)) {
$sql = "SELECT * FROM tipoad WHERE startdate &lt; NOW() ORDER BY startdate DESC";
$res = mysql_query($sql);
}
$curTip = mysql_fetch_array($res);
</PRE>
<P>В принципе, этот код избыточен. SQL-запрос можно заменить таким:</P><PRE class=js>SELECT * FROM tipoad WHERE startdate &lt;= NOW() ORDER BY startdate DESC
</PRE>
<P>Таким образом в первой строке результата мы получим или совет на текущий день или самый поздний из доступных. Следовательно оптимизированный код будет выглядеть так:</P><PRE class=js>$sql = "SELECT * FROM tipoad WHERE startdate &lt;= NOW() ORDER BY startdate DESC";
$res = mysql_query($sql);
$curTip = mysql_fetch_array($res);
</PRE>
<P>Хорошим тоном в программировании считается проверка на правильность выполнения команд. Иначе, в случае ошибки, мы будем получать малоинформативные сообщения. Проверка осуществляется так:</P><PRE class=js>$res = mysql_query($sql) <B>or die(mysql_error())</B>;
</PRE>
<P>При использовании данной конструкции, в случае ошибки, буде остановлено выполнение скрипта и выдано сообщение о причине ошибки.</P>
<P>Теперь необходимо разработать код для выдачи всех опубликованных на сегодняшний день советов. Для того, чтобы можно было просмотреть пропущенные или вернуться к уже просмотренным ранее.</P>
<P>Для этого можно использовать тот же SQL-запрос:</P><PRE class=js>SELECT * FROM tipoad WHERE startdate &lt;= NOW() ORDER BY startdate DESC
</PRE>
<P>Тут есть одна трудность. Если вы, усердно работая над базой советов, продержались (в отличие от меня) год, то такой запрос, во-первых, будет излишне нагружать mySQL, во-вторых, результат будет очень долго перекачиваться клиенту и, в-третьих, займет слишком много места в окне браузера. Для того, чтобы преодолеть эту трудность можно использовать запрос выборки заданного диапазона рядов. Для этого используется выражение <SPAN class=js>LIMIT <I>first</I>,<I>number</I></SPAN>, где <SPAN class=js><I>first</I></SPAN> - номер первого ряда, <SPAN class=js><I>number</I></SPAN> - количество выбираемых рядов. Необходимо заметить, что выборка и сортировка (<SPAN class=js>WHERE... </SPAN>и <SPAN class=js>ORDER BY... </SPAN>) будет производиться до того, как будет наложено ограничение на выбираемый диапазон рядов. Кроме того, если количество выбираемых рядов будет превышать количество рядов в таблице, то операция закончится без ошибки, но в результат попадет только фактическое количество рядов.</P>
<P>Таким образом, мы имеем инструмент для организации постраничного вывода. Ограничимся семью советами на страницу. Для большей наглядности кода разработаем функцию, которой будем передавать номер необходимой страницы. Номер первой строки будем вычислять путем умножения номера страницы на количество советов на странице. Код выбора советов для текущей страницы будет выглядеть следующим образом.</P><PRE class=js>function getAllTips($page) {
$tpp = 7;
$frst = $page*$tpp;
$sql = "SELECT * FROM tipoad WHERE startdate &lt;= NOW()
ORDER BY startdate ASC LIMIT $frst,$tpp";
$res = mysql_query($sql);
while ($tip = mysql_fetch_array($res)) {
// код обработки
}
</PRE>
<P>Продумать алгоритм генерации ссылок на предыдущую и следующую страницу предлагаю вам самостоятельно. Если это вызывает большие затруднения, то пишите мне (<A href="mailto:exper@inbox.ru">exper@inbox.ru</A>). В следующем опыте рассмотрим как реализуется часть, которая отвечает за размещение текста совета на чужих страницах.</P><FONT size=-2>©<A href="mailto:mine@convex.ru"> Андрей Головин</A> <A href="http://exper.ural.ru/"><A href="http://exper.ural.ru/</a>" target=_blank>http://exper.ural.ru/</A></A> </FONT><BR><BR>
<DIV align=right><SMALL><B>[ <A href="http://www.webscript.ru/print/21" target=_blank>Распечатать</A> ]::[ <A href="http://www.webscript.ru/friend/21">Переслать</A> ]::[ <A href="http://forums.webscript.ru">Обсудить</A> ]</B></SMALL></DIV>
<DIV></DIV><BR>
<DIV align=right><SMALL><B></B></SMALL></DIV></TD></TR></TBODY></TABLE><!-- STORY END -->
<DIV class=maintext align=right><B><U></U></B></DIV>Нет комментариев. <!-- MAIN START default -->
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=#f0f0f0 background="Webscript.ru    Совет дня Часть 2-Dateien\bg6.gif" border=0>
<TBODY>
<TR>
<TD class=mnu align=right background=""><A name=comments></A>
<FORM name=Com onsubmit="return validateComment()" action=http://www.webscript.ru/submit.php3 method=post>Имя: <INPUT class=frm maxLength=32 size=32 name=Author><BR>Email: <INPUT class=frm maxLength=96 size=32 name=AuthorEmail><BR>URL<INPUT class=frm maxLength=96 size=32 name=AuthorURL><BR>Запомнить мою информацию<INPUT type=checkbox name=save> <BR><TEXTAREA class=frm style="WIDTH: 100%" name=Content rows=10 wrap=physical cols=50></TEXTAREA><BR>* Html запрещен* Ваш E-mail опубликован не будет.<INPUT type=hidden value=comment name=what> <INPUT type=hidden value=21 name=ParentRid> <INPUT type=hidden value=21 name=TopRid> <INPUT type=hidden value=stories.php3?story=21 name=where> <INPUT class=frm style="FONT-WEIGHT: bold; WIDTH: 100%; BACKGROUND-COLOR: #ffff99" type=submit value="Отправить отзыв"> </FORM><BR></TD></TR></TBODY></TABLE><!-- MAIN END --></TD>
<TD width=1 bgColor=black><IMG height=1 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\p.gif" width=1></TD></TR></TBODY></TABLE><!-- реклама -->
<TABLE cellSpacing=0 cellPadding=0 width=762 bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="Webscript.ru    Совет дня Часть 2-Dateien\p.gif" width=762></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=10 width=762 bgColor=#aaaaaa border=0>
<TBODY>
<TR>
<TD></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=10 width=762 bgColor=#bbbbbb border=0>
<TBODY>
<TR>
<TD><!--begin of Top100 logo--><A href="http://top100.rambler.ru/top100/"><IMG height=31 alt="Rambler's Top100" src="Webscript.ru    Совет дня Часть 2-Dateien\banner-88x31-rambler-black2.gif" width=88 border=0></A> <!--end of Top100 logo --></TD>
<TD class=verd align=right>Copyright © 2000-2001 WebScript.Ru <A href="mailto:webmaster@webscript.ru">webmaster@webscript.ru</A><BR>Design © 2001 by <A href="http://parallax.nsk.su">Parallax Design Studio</A> (aka <A href="http://spectator.ru">Spectator.ru</A>)<BR>Все торговые марки и авторские права на эту страницу принадлежат их соответствующим владельцам.<BR><A href="http://top100.rambler.ru/top100/"><IMG height=1 alt="Rambler's Top100" src="Webscript.ru    Совет дня Часть 2-Dateien\top100.cnt.gif" width=1 border=0></A> Сгенерировано&nbsp;за:&nbsp;0.0702829</TD></TR></TBODY></TABLE></BODY></HTML>