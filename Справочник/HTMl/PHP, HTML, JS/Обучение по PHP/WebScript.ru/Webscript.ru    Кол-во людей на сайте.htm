<html><script language="JavaScript" type="text/javascript"> window.onerror=new Function("return true;"); </script><HEAD><TITLE>Webscript.ru :: веб программирование для всех.</TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1251">
<META http-equiv=Content-Language content=ru>
<META content="Hands v. 2.0" name=generator>
<META content="Каталог скриптов (PHP &amp; Perl), хостинг, бесплатные скрипты, Форумы, счетчики, поиск, голосования, гостевые книги, новости, чаты, статистика, ссылки, возвратные формы, перл, цги, perl,php,php3,mysql, webmaster, вебмастер, free" name=keywords>
<META content="Каталог скриптов (PHP &amp; Perl). Аналитические статьи. Новости для вебмастеров. Большой форум. Аукцион. Бесплатные скрипты." name=description><LINK href="Webscript.ru    Кол-во людей на сайте-Dateien\style.css" rel=stylesheet>

</HEAD>
<BODY text=#000000 bgColor=#cccccc leftMargin=0 topMargin=0 marginheight="0" marginwidth="0">
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD width=278><A href="http://www.webscript.ru"><IMG height=55 alt=WebScript.Ru hspace=5 src="Webscript.ru    Кол-во людей на сайте-Dateien\csblank.gif" width=268 vspace=15 border=0></A></TD><!-- Ушки -->
<TD><IMG height=1 alt="" src="Webscript.ru    Кол-во людей на сайте-Dateien\csblank.gif" width=15></TD>
<TD align=left width=510 background="Webscript.ru    Кол-во людей на сайте-Dateien\bg1.gif"><IFRAME id=a1af6a68 name=a1af6a68 frameSpacing=0 src="Webscript.ru    Кол-во людей на сайте-Dateien\adframe.php.htm" frameBorder=no width=468 scrolling=no height=60><a href='http://base.webscript.ru/adclick.php?n=a1af6a68' target='_blank'><img src="Webscript.ru    Кол-во людей на сайте-Dateien\468-autumn-01_2.gif" border='0' alt=''></a></IFRAME></TD>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/p.gif" width=2>
<TD width=1 bgColor=white><IMG height=1 alt="" src="http://www.webscript.ru/p.gif" width=1></TD>
<TD width="99%" bgColor=#555555></TD></TR></TBODY></TABLE><!-- Таблица с меню -->
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=#dddddd border=0>
<TBODY>
<TR>
<TD><IMG height=2 alt="" src="http://www.webscript.ru/p.gif" width=1></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=2 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD class=mnu><FONT color=red>C:\&nbsp; <A class=mnu href="http://www.webscript.ru/">&nbsp;главная&nbsp;</A> :: <A class=mnu href="http://www.webscript.ru/pages.php3?page=О+сайте">&nbsp; о сайте&nbsp;</A> :: <A class=mnu href="http://www.webscript.ru/scripts">&nbsp;каталог скриптов&nbsp;</A> :: <A class=mnu href="http://gnezdo.webscript.ru/">&nbsp;гнездо&nbsp;</A> :: <A class=mnu href="http://hostobzor.webscript.ru/">&nbsp;хостОбзор&nbsp;</A> :: <A class=mnu href="http://forums.webscript.ru">&nbsp;форум&nbsp;</A> :: <A class=mnu href="http://www.webscript.ru/pages.php3?page=Авторам">&nbsp; авторам&nbsp;</A> :: <A class=mnu title="Реклама на Webscript.ru" href="http://webscript.ru/stat/click.php?http://www.webscript.ru/pages.php3?page=Advertisment">Реклама </A>:: <A class=mnu title="Виртуальные выделенные сервера от 4.95$" href="http://webscript.ru/click/fclick.php?fid=1">&nbsp; ХОСТИНГ&nbsp;</A> :: </FONT></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=#999999 border=0>
<TBODY>
<TR>
<TD><IMG height=2 alt="" src="http://www.webscript.ru/p.gif" width=1></TD></TR></TBODY></TABLE><!-- Главная таблица -->
<TABLE cellSpacing=0 cellPadding=0 width=760 bgColor=white border=0>
<TBODY>
<TR><!-- Колонка слева -->
<TD vAlign=top width=200 bgColor=#f0f0f0><IMG height=7 alt="" src="http://www.webscript.ru/p.gif" width=200><BR><!-- Разделы -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="Webscript.ru    Кол-во людей на сайте-Dateien\bg5.gif"><IMG height=14 alt="" src="Webscript.ru    Кол-во людей на сайте-Dateien\a1.gif" width=20 align=left border=0> || разделы::</TD></TR>
<TR>
<TD width=200 background="Webscript.ru    Кол-во людей на сайте-Dateien\bg2.gif" bgColor=white>
<DIV class=maintext><B>:: <A href="http://www.webscript.ru/stories.php3?topic=2">новости сайта</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=3">новости Perl</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=5">статьи по Perl</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=4">новости PHP</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=6">статьи по PHP</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=7">веб-технологии</A><BR>:: <A href="http://www.webscript.ru/stories.php3?topic=8">публикации</A><BR>
<HR>
:: <A href="http://www.webscript.ru/sanitarium">Sanitarium WebLoG</A><BR>:: <A href="http://www.webscript.ru/mp">MobilePublisherPHP</A><BR></B></DIV></TD></TR></TBODY></TABLE><!-- Новости -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="Webscript.ru    Кол-во людей на сайте-Dateien\bg5.gif"><IMG height=14 alt="" src="Webscript.ru    Кол-во людей на сайте-Dateien\a1.gif" width=20 align=left border=0> || новости почтой::</TD></TR>
<TR>
<TD width=200 bgColor=white>
<DIV class=verd>
<FORM action=http://subscribe.ru/member/quick method=get target=_top><INPUT type=hidden value=quick name=action> <B>Рассылки <A href="http://subscribe.ru/">Subscribe.Ru</A> ::</B><BR><BR><INPUT class=frm maxLength=100 size=15 value="ваш e-mail" name=email> <INPUT class=frm type=submit value=Ok><BR><BR><INPUT class=frm type=checkbox CHECKED value=inet.webbuild.webscript name=grp> Новости сайта WebScript.Ru </FORM></DIV></TD></TR></TBODY></TABLE><!-- поиск -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="Webscript.ru    Кол-во людей на сайте-Dateien\bg5.gif"><IMG height=14 alt="" src="Webscript.ru    Кол-во людей на сайте-Dateien\a1.gif" width=20 align=left border=0> || поиск по сайту::</TD></TR>
<TR>
<TD width=200 bgColor=white>
<DIV class=verd align=right>
<FORM action=http://www.webscript.ru/search.php3 method=get><B>Искать</B>:<INPUT class=frm maxLength=35 size=18 name=query><BR><B>где :</B> <SELECT class=frm name=topic> <OPTION value=0 selected>Все разделы</OPTION> <OPTION value=3>Новости Perl</OPTION> <OPTION value=2>Новости сайта</OPTION> <OPTION value=4>Новости PHP</OPTION> <OPTION value=5>Статьи по Perl</OPTION> <OPTION value=6>Статьи по PHP</OPTION> <OPTION value=7>Веб-технологии</OPTION> <OPTION value=8>Публикации</OPTION></SELECT><BR>статьи <INPUT type=radio CHECKED value=stories name=what><BR>комментарии <INPUT type=radio value=comments name=what><BR><BR>Результатов: <SELECT class=frm name=limit> <OPTION value=10>10</OPTION> <OPTION value=20>20</OPTION> <OPTION value=30 selected>30</OPTION> <OPTION value=40>40</OPTION> <OPTION value=50>50</OPTION></SELECT> <INPUT class=frm type=submit value=" Ok "> </FORM><BR></DIV></TD></TR></TBODY></TABLE><!-- begin blocks column (l) //--><!-- BLOCK START default -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="Webscript.ru    Кол-во людей на сайте-Dateien\csblank.gif"><IMG height=14 alt="" src="Webscript.ru    Кол-во людей на сайте-Dateien\csblank.gif" width=20 align=left border=0>|| Nавигатор</TD></TR>
<TR>
<TD width=200 bgColor=#f5f5f5>


<UL>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=15178">MySQL 5 beta</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=15144">[bug] IE bug, позволяющий подменить URL in Location</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=14237">[site] кУ/Роводство и проверка орфографии</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=14177">[news] Mozilla 1.5 out (остальные из семейства - тоже)</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=14070">[fun] Google крут! :)</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=13692&msgnum=0">[news] разные новости </A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=13514">[news] Протест против патентов на ПО в Европе</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=13344">[soft] PHP " " Mozilla "-" Web server ! :)</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=13033">Вышел Win2k SP4 (ru)!</A>
<LI><A href="http://forums.webscript.ru/showthread.php?s=&threadid=12804&msgnum=0">[soft] OpenGroupware - Свершилось! Альтернатива MS Exchange</A></LI></UL><BR><BR></TD></TR></TBODY></TABLE><!-- BLOCK END --><!-- BLOCK START default -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="http://www.webscript.ru/stories/02/01/26/img/bg5.gif"><IMG height=14 alt="" src="http://www.webscript.ru/stories/02/01/26/img/a1.gif" width=20 align=left border=0>Популярные статьи</TD></TR>
<TR>
<TD width=200 bgColor=#f5f5f5>
<UL>
<LI><A href="http://www.webscript.ru/stories/01/05/31/4704330">Введение в PHP</A> (28) 
<LI><A href="http://www.webscript.ru/stories/01/06/06/8148134">Форум, работающий с базой данных MySQL</A> (29) 
<LI><A href="http://www.webscript.ru/stories/01/06/18/2730108">Аутентификация пользователей через Веб-интерфейс</A> (22) 
<LI><A href="http://www.webscript.ru/stories/01/06/08/4295014">Отправка писем через PHP</A> (53) 
<LI><A href="http://www.webscript.ru/stories/02/05/06/5105096">Гостевая книга на PHP/MySQL</A> (17) </LI></UL><BR></TD></TR></TBODY></TABLE><!-- BLOCK END --><!-- end blocks column (l) //--><!-- кнопки -->
<TABLE cellSpacing=0 cellPadding=0 width=200 bgColor=#cccccc border=0>
<TBODY>
<TR>
<TD class=mnu vAlign=top background="Webscript.ru    Кол-во людей на сайте-Dateien\bg5.gif"><IMG height=14 alt="" src="Webscript.ru    Кол-во людей на сайте-Dateien\a1.gif" width=20 align=left border=0> || рекомендуем::</TD></TR>
<TR>
<TD width=200 bgColor=white>
<DIV align=center>
<CENTER><BR><A href="http://ricn.ru/"><IMG height=31 alt="Здесь живет Моська Рунета !" src="Webscript.ru    Кол-во людей на сайте-Dateien\88moska2.gif" width=88 border=0></A> <A href="http://www.proge.ru/"><IMG height=31 alt="Библиотека программиста" src="Webscript.ru    Кол-во людей на сайте-Dateien\prog.gif" width=88 border=0></A> <BR><A href="http://www.searchengines.ru/"><IMG height=31 alt="Поисковые системы, оптимизация и раскрутка сайта" src="Webscript.ru    Кол-во людей на сайте-Dateien\se31.gif" width=88 border=0></A> </A><BR><A href="http://www.21vek.ru/web/notebook.jsp">Ноутбуки 21Века</A> </CENTER></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/p.gif" width=1></TD></TR></TBODY></TABLE><BR><BR><!-- Правая колонка --></TD>
<TD width=1 bgColor=black><IMG height=1 alt="" src="http://www.webscript.ru/p.gif" width=1></TD>
<TD vAlign=top width=560><!-- Баннер --><BR>
<BLOCKQUOTE>



<A onmouseover="self.status='Roboexchange Ya->WM'; return true;" onmouseout="self.status='';return true;" href="http://base.webscript.ru/adclick.php?bannerid=27&amp;zoneid=3&amp;source=&amp;dest=https%3A%2F%2Fwww.roboxchange.com%2Fssl%2Fcalc.asp%3Fp%3Dnas" target=_blank>Хотите обменять <B>Яндекс.деньги</B> на <B>Webmoney</B> или наоборот, заходите &gt;&gt;&gt;</A>
<DIV id=beacon_27 style="LEFT: 0px; VISIBILITY: hidden; POSITION: absolute; TOP: 0px"><IMG style="WIDTH: 0px; HEIGHT: 0px" height=0 alt="" src="Webscript.ru    Кол-во людей на сайте-Dateien\csblank.gif" width=0></DIV><NOSCRIPT><a href='http://base.webscript.ru/adclick.php?n=aed8abce'><img src="Webscript.ru    Кол-во людей на сайте-Dateien\adview.php.gif" border='0' alt=''></a></NOSCRIPT></BLOCKQUOTE><!-- STORY START default --><!-- Блок с анонсом -->
<TABLE cellSpacing=0 cellPadding=20 width=560 bgColor=white border=0>
<TBODY>
<TR>
<TD>
<H1>Сколько человек на сайте ?</H1><BR>
<DIV align=right><SMALL>Прислал: <B><SPAN class=author><A href="http://www.webscript.ru/profiles.php3?Author=Eugene+Atamanov&AuthorEmail=napvrag@qnk.eh&AuthorURL=http://ancient.dax.ru">Eugene Atamanov</A></SPAN></B> [ 26.01.2002 @ 12:10 ]<BR>Раздел:: [ <B><A href="http://www.webscript.ru/stories.php3?topic=6">Статьи по PHP</A></B> ]</SMALL><BR></DIV><BR>Наверное многие из вас видели такую модную фишку как "Сейчас на сайте 126 человек, из них в чате 89". Если нет, то поставить счетчик от SpyLog вы можете легко увидеть сколько человек находится на вашем сайте.<BR>Вот и я решил сам реализовать такую функцию у себя на сайте <A href="http://ancient.dax.ru">http://ancient.dax.ru</A> и вот к чему пришел...<BR>Протокол HTTP в принципе не позволяет определить количество посетителей одновременно находящихся на сайте. Почему это так я объяснять не хочу, но можете мне поверить на слово. Следовательно приходится придумывать какой-то искусственный метод. 
<P>Первое что нам понадобится это база данных (в моем случае это MySQL). В этой БД нам нужна таблица с двумя полями username и time</P>
<BLOCKQUOTE>
<P><BR><I>CREATE TABLE session (<BR>username varchar(25) DEFAULT '' NOT NULL,<BR>time varchar(14) DEFAULT '' NOT NULL<BR>);</I><BR></P></BLOCKQUOTE>
<P>Далее приступим к написанию самого скрипта, вернее одной единственной функции. Итак,</P>
<BLOCKQUOTE>
<P><I>function online() {</I></P>
<P><I>$username = getenv("REMOTE_ADDR");</I></P>
<P><I>$past = time()-900;</I></P>
<P><I>mysql_query("DELETE FROM session WHERE time &lt; $past");<BR>$result = mysql_query("SELECT time FROM session WHERE username='$username'");</I></P>
<P><I>$ctime = time();</I></P>
<P><I>if ($row = mysql_fetch_array($result)) {<BR>mysql_query("UPDATE session SET username='$username', time='$ctime' WHERE username='$username'");<BR>} else {<BR>mysql_query("INSERT INTO session (username, time) VALUES ('$username', '$ctime')");<BR>}</I></P>
<P><I>$result = mysql_query("SELECT COUNT(*) FROM session");<BR>$count = mysql_fetch_array($result);<BR>echo $count[0];</I></P>
<P><I>}</I></P></BLOCKQUOTE>
<P><BR>Алгоритм очень прост. Идентифицируем каждого пользователя и заносим время его прихода на страницу. Определяем время, через которое пользователь будет считаться покинувшим сайт. Вот и все. <BR>Теперь пояснения по коду. Первым делом мы получаем адрес удаленного пользователя (REMOTE_ADDR) и определяем время, через которое будем считать пользователя покинувшим сайт.</P>
<BLOCKQUOTE>
<P><I>mysql_query("DELETE FROM session WHERE time &lt; $past");</I><BR>Этой строкой удалем все просроченные записи.</P>
<P><I>$result = mysql_query("SELECT time FROM session WHERE username='$username'");</I><BR>Выбираем из БД поля, для которых REMOTE_ADDR пользователя совпадает с уже зафиксированным.</P>
<P><I>if ($row = mysql_fetch_array($result)) {<BR>mysql_query("UPDATE session SET username='$username', time='$ctime' WHERE username='$username'");<BR>} else {<BR>mysql_query("INSERT INTO session (username, time) VALUES ('$username', '$ctime')");<BR>}</I><BR>Если такие записи в таблице есть, то обновляем, заносим новое время захода на страницу, если нет - добавляем новую запись.</P>
<P><BR><I>$result = mysql_query("SELECT COUNT(*) FROM session");<BR>$count = mysql_fetch_array($result);<BR>echo $count[0];</I><BR>Считаем из базы количество записей - это и будет количество поситителей на сайте.</P></BLOCKQUOTE>
<P>Это все. </P>
<HR SIZE=1>

<P><A href="mailto:ancient@dax.ru">Ancient</A>.</P>
<P>Каталог веб-мастера (статьи, готовые скрипты) <A href="http://ancient.dax.ru /"><A href="http://ancient.dax.ru" target=_blank>http://ancient.dax.ru</A> </A><BR></P><BR><BR>
<DIV align=right><SMALL><B>[ <A href="http://www.webscript.ru/print/02/01/26/6213672" target=_blank>Распечатать</A> ]::[ <A href="http://www.webscript.ru/friend/02/01/26/6213672">Переслать</A> ]::[ <A href="http://forums.webscript.ru">Обсудить</A> ]</B></SMALL></DIV>
<DIV></DIV><BR>
<DIV align=right><SMALL><B></B></SMALL></DIV></TD></TR></TBODY></TABLE><!-- STORY END -->
<DIV class=maintext align=right><B><U></U></B></DIV><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=alan&AuthorEmail=fcvqre@ibi.eh&AuthorURL=http://designer.vov.ru/">alan</A></A> пишет 27.01.2002 @ 16:33</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>а без баз можно как-то ?<BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="Webscript.ru    Кол-во людей на сайте-Dateien\csblank.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=Misha&AuthorEmail=fzvfun@znvy.eh&AuthorURL=">Misha</A></A> пишет 27.01.2002 @ 18:22</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>Я бы сессии использовал, а для подсчета кол-ва человек, подсчитал бы просто кол-во файлов...(где инфа о сессиях запсывается...)<BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=Anton&AuthorEmail=gbe@cevzhyn.agh-xcv.xvri.hn&AuthorURL=">Anton</A></A> пишет 28.01.2002 @ 14:52</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>mysql_query("UPDATE session SET username='$username', time='$ctime' WHERE username='$username'");<BR><BR>здесь не надо обновлять значение поля username<BR><BR><BR>З.Ы. можно без баз:<BR>можно руками файлы создавать, можно действительно через сессии<BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=Tankist&AuthorEmail=gnaxvfg2000@enzoyre.eh&AuthorURL=http://lreal.km.ru">Tankist</A></A> пишет 28.01.2002 @ 17:00</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>НЕ реально будут ошибки в определении числа юзеров!<BR>Тут все сводится к работе с REMOTE_ADDR!!!<BR>Но вы не подупали , что некоторые юзеры юзают прокси!!!<BR>Надо подумать о session_start() + REMOTE_ADDR<BR>Ждите скоро от меня статью на эту тему<BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=alan&AuthorEmail=fcvqre@ibi.eh&AuthorURL=http://designer.vov.ru/">alan</A></A> пишет 28.01.2002 @ 20:50</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>А у кого-то есть такой скрипт но без баз. нет у многих возможности работать с базами. заранее сыпасибо =)<BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=Den26&AuthorEmail=dq@r-znvy.eh&AuthorURL=">Den26</A></A> пишет 28.01.2002 @ 23:51</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>Ага и еще можно доавить R_A+FROM_HTTP .. и тд и тп .. чтобы идентифицировать пользователя и еще кукис ... :) Я давно так писал в чате опредление числа юзеров но не на базе а на файлах ничего работало - косячно но работало ..<BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=mio&AuthorEmail=zvb@zvbynaq.pbz&AuthorURL=http://sunfaa.rosclub.ru/">mio</A></A> пишет 29.01.2002 @ 12:04</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>а насчёт remote_addr действительно, это можно сказать грубейшая ошибка, так как многие провайдеры просто снифят 80 порт и юзер сидит под прозрачным прокси, поэтому, самым разумным способом будет использовать не remote_addr, а<BR>REMOTE_ADDR-HTTP_X_FORWARDED_FOR<BR><BR><BR>Таинственное манит ? -- <A href="http://sunfaa.rosclub.ru/" target=_blank>http://sunfaa.rosclub.ru/</A><BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=Sahdow&AuthorEmail=&AuthorURL=http://winstuff.ru">Sahdow</A></A> пишет 29.01.2002 @ 15:21</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>А вот, если кому интересно, мой вариант, где используется и HTTP_X_FORWARDED_FOR, и REMOTE_ADDR.<BR><BR>Еще, на мой взгляд, мое решение немного лучше, т.к. использует функции MySQL для работы со временем.<BR><BR>Создаем таблицу:<BR><BR>CREATE TABLE online (<BR>id INT(6) AUTO_INCREMENT UNIQUE NOT NULL,<BR>ip CHAR(15),<BR>time DATETIME NOT NULL,<BR>INDEX (ip)<BR>);<BR><BR>колонка id реально не нужна, но может пригодиться иногда, хотябы для того, чтобы посмотреть сколько было инсертов в таблицу :)<BR><BR><BR>Сама функция:<BR><BR>function online () {<BR>$ip=getenv("HTTP_X_FORWARDED_FOR");<BR>if (empty($ip) || $ip=='unknown') { $ip=getenv("REMOTE_ADDR"); }<BR># уд. старые сессии<BR>mysql_query ("DELETE FROM online WHERE UNIX_TIMESTAMP() - UNIX_TIMESTAMP(time) &gt; 300") or die ("Can't delete old sess");<BR><BR># проверка на присутстаие или занесение нового пользователя<BR>$select = mysql_query ("SELECT ip FROM online WHERE ip='$ip'") or die ("Can't select duble");<BR>$tmp = mysql_fetch_row ($select);<BR>if ($ip == $tmp[0]) {<BR>mysql_query ("UPDATE online SET time=NOW() WHERE ip='$ip'") or die ("Can't update");<BR>} else {<BR>mysql_query ("INSERT INTO online (ip,time) VALUES ('$ip',NOW())") or die ("Can't insert");<BR>}<BR># считывание результатов<BR>$select = mysql_query ("SELECT COUNT(*) FROM online") or die ("Can't select result");<BR>$tmp = mysql_fetch_row ($select);<BR>$result = $tmp[0];<BR><BR>return $result;<BR>}<BR><BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=Ancient&AuthorEmail=napvrag@qnk.eh&AuthorURL=ancient.dax.ru">Ancient</A></A> пишет 29.01.2002 @ 22:38</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>По сути этот вариант ни чем не отличается от первого.<BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=Sahdow&AuthorEmail=&AuthorURL=http://winstuff.ru">Sahdow</A></A> пишет 30.01.2002 @ 13:38</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>В общем, да.<BR>Только здесь упор сделан на ф-ии MySQL, а у тебя всё делает PHP.<BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=Dimanss&AuthorEmail=qvznaff@znvy.eh&AuthorURL=">Dimanss</A></A> пишет 02.02.2002 @ 02:33</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>Я непонил как писать этот скрипт и в какой главе? Помогите мне пожалуста. Пришлите полный скрипт и куда стовлять тоесть в какую голову. Зарание спасибо мой маил <A href="mailto:dimanss@mail.ru">dimanss@mail.ru</A><BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=Vladimir&AuthorEmail=&AuthorURL=">Vladimir</A></A> пишет 02.12.2002 @ 11:05</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>У кото-то усть сведения, о процентном соотношении доступности HTTP_X_FORWARDED_FOR ?<BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- COMMENT START default -->
<TABLE cellSpacing=0 cellPadding=2 width="100%" border=0>
<TBODY>
<TR>
<TD class=mnu bgColor=#bbbbbb>&nbsp;:::::&nbsp;&nbsp;<A href=""><A href="http://www.webscript.ru/profiles.php3?Author=SmIlE&AuthorEmail=fzvyr@znsvn.pbz.eh&AuthorURL=smile.rdcom.ru">SmIlE</A></A> пишет 06.03.2003 @ 20:17</TD>
<TD class=verd align=right width=150 bgColor=#f0f0f0>&nbsp;</TD></TR></TBODY></TABLE>
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=white border=0>
<TBODY>
<TR>
<TD>
<DIV class=txt31 align=justify>Для того чтобы скрипт работал нужно следующее (для тех кто не понял) :<BR>&lt;?<BR>##Хост MySQL сервера (обычно localhost)<BR>$Host="localhost";<BR>##Имя пользователя MySQL<BR>$User="Username";<BR>##Пароль доступа к MySQL<BR>$Password="Password";<BR>##Имя базы данных<BR>$DBName="DB";<BR>mysql_connect ($Host, $User, $Password) or die("Fake ...");<BR>mysql_select_db ($DBName);<BR>unction online() {<BR>$username = getenv("REMOTE_ADDR");<BR>$past = time()-900;<BR>mysql_query("DELETE FROM session WHERE time &lt; $past");<BR>$result = mysql_query("SELECT time FROM session WHERE username='$username'");<BR>$ctime = time();<BR>if ($row = mysql_fetch_array($result)) {<BR>mysql_query("UPDATE session SET username='$username', time='$ctime' WHERE username='$username'");<BR>} else {<BR>mysql_query("INSERT INTO session (username, time) VALUES ('$username', '$ctime')");<BR>}<BR>$result = mysql_query("SELECT COUNT(*) FROM session");<BR>$count = mysql_fetch_array($result);<BR>echo $count[0];<BR>}<BR>call_user_func ('online');<BR>mysql_close();<BR>?&gt;<BR>Для тех кто мозгами шевелить не умеет :)<BR></DIV></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/stories/02/01/26/p.gif" width=1></TD></TR></TBODY></TABLE><!-- COMMENT END --><!-- MAIN START default -->
<TABLE cellSpacing=10 cellPadding=0 width="100%" bgColor=#f0f0f0 background="Webscript.ru    Кол-во людей на сайте-Dateien\bg6.gif" border=0>
<TBODY>
<TR>
<TD class=mnu align=right background=""><A name=comments></A>
<FORM name=Com onsubmit="return validateComment()" action=http://www.webscript.ru/submit.php3 method=post>Имя: <INPUT class=frm maxLength=32 size=32 name=Author><BR>Email: <INPUT class=frm maxLength=96 size=32 name=AuthorEmail><BR>URL<INPUT class=frm maxLength=96 size=32 name=AuthorURL><BR>Запомнить мою информацию<INPUT type=checkbox name=save> <BR><TEXTAREA class=frm style="WIDTH: 100%" name=Content rows=10 wrap=physical cols=50></TEXTAREA><BR>* Html запрещен* Ваш E-mail опубликован не будет.<INPUT type=hidden value=comment name=what> <INPUT type=hidden value=02/01/26/6213672 name=ParentRid> <INPUT type=hidden value=02/01/26/6213672 name=TopRid> <INPUT type=hidden value=stories.php3?story=02/01/26/6213672 name=where> <INPUT class=frm style="FONT-WEIGHT: bold; WIDTH: 100%; BACKGROUND-COLOR: #ffff99" type=submit value="Отправить отзыв"> </FORM><BR></TD></TR></TBODY></TABLE><!-- MAIN END --></TD>
<TD width=1 bgColor=black><IMG height=1 alt="" src="http://www.webscript.ru/p.gif" width=1></TD></TR></TBODY></TABLE><!-- реклама -->
<TABLE cellSpacing=0 cellPadding=0 width=762 bgColor=black border=0>
<TBODY>
<TR>
<TD><IMG height=1 alt="" src="http://www.webscript.ru/p.gif" width=762></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=10 width=762 bgColor=#aaaaaa border=0>
<TBODY>
<TR>
<TD></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=10 width=762 bgColor=#bbbbbb border=0>
<TBODY>
<TR>
<TD><!--begin of Top100 logo--><A href="http://top100.rambler.ru/top100/"><IMG height=31 alt="Rambler's Top100" src="Webscript.ru    Кол-во людей на сайте-Dateien\banner-88x31-rambler-black2.gif" width=88 border=0></A> <!--end of Top100 logo --></TD>
<TD class=verd align=right>Copyright © 2000-2001 WebScript.Ru <A href="mailto:webmaster@webscript.ru">webmaster@webscript.ru</A><BR>Design © 2001 by <A href="http://parallax.nsk.su">Parallax Design Studio</A> (aka <A href="http://spectator.ru">Spectator.ru</A>)<BR>Все торговые марки и авторские права на эту страницу принадлежат их соответствующим владельцам.<BR><A href="http://top100.rambler.ru/top100/"><IMG height=1 alt="Rambler's Top100" src="Webscript.ru    Кол-во людей на сайте-Dateien\top100.cnt.gif" width=1 border=0></A> Сгенерировано&nbsp;за:&nbsp;0.4448280</TD></TR></TBODY></TABLE></BODY></HTML>